// ĞœĞ¾Ğ´ÑƒĞ»ÑŒ 00: Core Network & Identity

model Business {
  id          String  @id @default(cuid())
  name        String
  is_archived Boolean @default(false)

  // Ownership Handshake logic
  ownerId         String
  newOwnerId      String?
  handshakeStatus HandshakeStatus @default(IDLE)
  handshakeAt     DateTime? // ĞšÑƒĞ»Ğ´Ğ°ÑƒĞ½ 168 Ñ‡Ğ°ÑĞ¾Ğ²

  enterprises Enterprise[]
  members     Member[]
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt

  @@index([ownerId])
}

model Enterprise {
  id          String   @id @default(cuid())
  name        String
  businessId  String
  business    Business @relation(fields: [businessId], references: [id])
  units       Unit[]
  is_archived Boolean  @default(false)

  @@index([businessId])
}

model Unit {
  id       String  @id @default(cuid())
  name     String
  address  String?
  timezone String  @default("UTC")

  // Capabilities Logic
  capabilities String[] // ğŸ“¦, ğŸ”ª, ğŸ‘¥, ğŸšš, ğŸ’°, ğŸ“
  tags         String[] // #ĞšĞ¾Ñ„ĞµĞ¹Ğ½Ñ, #Ğ¡Ğ¾Ğ±ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ°Ñ
  allowed_ip   String? // Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ

  enterpriseId String
  enterprise   Enterprise @relation(fields: [enterpriseId], references: [id])
  businessId   String
  is_archived  Boolean    @default(false)

  @@index([businessId])
  @@index([enterpriseId])
}

model Member {
  id         String   @id @default(cuid())
  userId     String
  businessId String
  business   Business @relation(fields: [businessId], references: [id])
  role       Role     @default(STAFF) // OWNER, MANAGER, STAFF

  @@unique([userId, businessId])
  @@index([businessId])
}

enum HandshakeStatus {
  IDLE
  PENDING
}

enum Role {
  OWNER
  MANAGER
  STAFF
}
