## üöÄ –°–ø—Ä–∏–Ω—Ç ‚Ññ4: Attendance Guard (–£—á–µ—Ç –≤—Ä–µ–º–µ–Ω–∏ –∏ –ì—Ä–∞—Ñ–∏–∫–∏)

**–¶–µ–ª—å:** –ó–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —É—á–µ—Ç–∞ —Ä–∞–±–æ—á–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ —Å –∑–∞—â–∏—Ç–æ–π –æ—Ç —Ñ—Ä–æ–¥–∞ (–æ–±–º–∞–Ω–∞ –ø–æ GPS/VPN) –∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–µ–π –§–û–¢.

---

## –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –°–ø—Ä–∏–Ω—Ç–∞ ‚Ññ4

| –ö—Ä–∏—Ç–µ—Ä–∏–π | –•–æ—Ä–æ—à–∏–π | –õ—É—á—à–∏–π | –û–ø—Ç–∏–º–∞–ª—å–Ω—ã–π (–ú–æ–π –≤—ã–±–æ—Ä) |
| --- | --- | --- | --- |
| **–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è** | –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç —Ç–æ–ª—å–∫–æ –≤ –º–æ–º–µ–Ω—Ç –Ω–∞–∂–∞—Ç–∏—è ¬´–°—Ç–∞—Ä—Ç¬ª. | –ü—Ä–æ–≤–µ—Ä–∫–∞ GPS + IP-–∞–¥—Ä–µ—Å–∞ —Ç–æ—á–∫–∏. | **Security Loop**: –§–æ–Ω–æ–≤—ã–π Geofencing (—Ä–∞–∑ –≤ 15 –º–∏–Ω) + —Å–≤–µ—Ä–∫–∞ EXIF/GPS –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∑–∞–¥–∞—á (Mod 08). |
| **–ó–∞–∫—Ä—ã—Ç–∏–µ —Å–º–µ–Ω** | –†—É—á–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º –∑–∞–±—ã—Ç—ã—Ö —Ç–∞–π–º–µ—Ä–æ–≤. | –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –±–∞—Ä–∏—Å—Ç–∞ –æ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞. | **Anti-Zombie Algorithm**: –ê–≤—Ç–æ-–∑–∞–∫—Ä—ã—Ç–∏–µ —Å–º–µ–Ω >20 —á–∞—Å–æ–≤ —Å –ø–µ—Ä–µ–≤–æ–¥–æ–º –≤ —Å—Ç–∞—Ç—É—Å `Pending Approval`. |
| **–°—Ç–∞–≤–∫–∏ (Rates)** | –†–∞—Å—á–µ—Ç –ø–æ —Ç–µ–∫—É—â–µ–π —Å—Ç–∞–≤–∫–µ –∏–∑ –ø—Ä–æ—Ñ–∏–ª—è –≤ –∫–æ–Ω—Ü–µ –º–µ—Å—è—Ü–∞. | –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å—Ç–∞–≤–æ–∫ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ. | **Rate Snapshot**: –§–∏–∫—Å–∞—Ü–∏—è —Ç–µ–∫—É—â–µ–π —Å—Ç–∞–≤–∫–∏ –∏ —Ä–æ–ª–∏ –≤ –º–æ–º–µ–Ω—Ç –Ω–∞–∂–∞—Ç–∏—è ¬´–°—Ç–∞—Ä—Ç¬ª –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç –∫–æ–ª–ª–∏–∑–∏–π. |
| **–û–±–º–µ–Ω —Å–º–µ–Ω–∞–º–∏** | –ü—Ä–∞–≤–∫–∞ –≥—Ä–∞—Ñ–∏–∫–∞ –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º –ø–æ –ø—Ä–æ—Å—å–±–µ. | –ó–∞—è–≤–∫–∞ –Ω–∞ –æ–±–º–µ–Ω —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º –∞–¥–º–∏–Ω–∞. | **Shift Swaps Handshake**: –ë–∏—Ä–∂–∞ —Å–º–µ–Ω (¬´–ú–∞—Ä–∫–µ—Ç¬ª) —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –ª–∏–º–∏—Ç–∞ –æ—Ç–¥—ã—Ö–∞ (–º–∏–Ω. 8—á) –º–µ–∂–¥—É —Å–º–µ–Ω–∞–º–∏. |

---

### 1. –£—á–µ—Ç –≤—Ä–µ–º–µ–Ω–∏ –∏ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (Backend & Logic)

* **Rate Snapshot Engine**: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –º–µ—Ö–∞–Ω–∏–∑–º–∞ –∑–∞—Ö–≤–∞—Ç–∞ —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –≤ –º–æ–º–µ–Ω—Ç –æ—Ç–∫—Ä—ã—Ç–∏—è —Å–º–µ–Ω—ã. –≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –µ—Å–ª–∏ —Å—Ç–∞–≤–∫–∞ –∏–∑–º–µ–Ω–∏—Ç—Å—è –∑–∞–≤—Ç—Ä–∞, –≤—á–µ—Ä–∞—à–Ω—è—è —Å–º–µ–Ω–∞ –±—É–¥–µ—Ç —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–∞ –ø–æ —Å—Ç–∞—Ä–æ–π —Ü–µ–Ω–µ.
* **Anti-Zombie Script**: –§–æ–Ω–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å, –æ—Ç—Å–ª–µ–∂–∏–≤–∞—é—â–∏–π –∞–Ω–æ–º–∞–ª—å–Ω–æ –¥–ª–∏–Ω–Ω—ã–µ —Å–º–µ–Ω—ã. –ü—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞ (–Ω–∞–ø—Ä. 20 —á–∞—Å–æ–≤) —Ç–∞–π–º–µ—Ä –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è, –∞ —Å–º–µ–Ω–∞ –ø–æ–º–µ—á–∞–µ—Ç—Å—è –¥–ª—è —Ä—É—á–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º.
* **Double Shift Guard**: –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –æ—Ç–∫—Ä—ã—Ç—å –≤—Ç–æ—Ä—É—é —Å–º–µ–Ω—É, –µ—Å–ª–∏ –ø–µ—Ä–≤–∞—è –Ω–µ –∑–∞–∫—Ä—ã—Ç–∞, –∏–ª–∏ –µ—Å–ª–∏ –º–µ–∂–¥—É –Ω–∏–º–∏ –ø—Ä–æ—à–ª–æ –º–µ–Ω–µ–µ 8 —á–∞—Å–æ–≤.
* **Geofencing & IP Gate**: –°–≤–µ—Ä–∫–∞ IP-–∞–¥—Ä–µ—Å–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ —Å `allowed_ip` —é–Ω–∏—Ç–∞ (–∏–∑ –ú–æ–¥—É–ª—è 00) –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ GPS-–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å–º–µ–Ω—ã.

### 2. –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è (UI/UX)

* **Bento Scheduler**: –°–µ—Ç–∫–∞ –≥—Ä–∞—Ñ–∏–∫–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º CSS Grid. –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ (–§–ò–û) –∏ —à–∞–ø–∫–∞ (–¥–∞—Ç—ã) —Ñ–∏–∫—Å–∏—Ä—É—é—Ç—Å—è –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ (Sticky).
* **Role Capacity Alert**: –í–∏–∑—É–∞–ª—å–Ω–∞—è –∏–Ω–¥–∏–∫–∞—Ü–∏—è –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏ —Å—Ç–∞–Ω—Ü–∏–π. –ï—Å–ª–∏ –Ω–∞ ¬´–ö–æ—Ñ–µ–º–∞—à–∏–Ω—É¬ª –Ω–∞–∑–Ω–∞—á–µ–Ω–æ –±–æ–ª—å—à–µ –ª—é–¥–µ–π, —á–µ–º –ø–æ–∑–≤–æ–ª—è–µ—Ç –ª–∏–º–∏—Ç —é–Ω–∏—Ç–∞, —Å–∏—Å—Ç–µ–º–∞ –≤—ã–¥–∞–µ—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ.
* **Shift Swaps Market**: –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤, –≥–¥–µ –æ–Ω–∏ –º–æ–≥—É—Ç –≤—ã—Å—Ç–∞–≤–∏—Ç—å —Å–≤–æ—é —Å–º–µ–Ω—É –Ω–∞ ¬´–±–∏—Ä–∂—É¬ª –∏–ª–∏ –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –∫–æ–ª–ª–µ–≥–µ.

### 3. –ú–æ–±–∏–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (Staff App)

* **Shift Gate Overlay**: –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã–º —Ñ—É–Ω–∫—Ü–∏—è–º (—á–µ–∫-–ª–∏—Å—Ç—ã, –¢–¢–ö), –µ—Å–ª–∏ —É —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–π –æ—Ç–∫—Ä—ã—Ç–æ–π —Å–º–µ–Ω—ã.
* **Personal Paystub Preview**: –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–æ–≥–Ω–æ–∑–Ω–æ–≥–æ –∑–∞—Ä–∞–±–æ—Ç–∫–∞ –∑–∞ —Ç–µ–∫—É—â—É—é —Å–º–µ–Ω—É –∏ –º–µ—Å—è—Ü –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω—ã—Ö —á–∞—Å–æ–≤ –∏ Rate Snapshots.

---

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è: –°—Ö–µ–º–∞ —Å–º–µ–Ω –∏ –¢–∞–π–º–∏–Ω–≥–æ–≤

```typescript
// prisma/schema.prisma (–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ)

model Shift {
  id              String   @id @default(cuid())
  employeeId      String
  unitId          String
  businessId      String   @index
  
  // –ü–ª–∞–Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
  plannedStart    DateTime
  plannedEnd      DateTime
  roleId          String   // –†–æ–ª—å –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é —Å–º–µ–Ω—É (–Ω–∞–ø—Ä. "–ë–∞—Ä–∏—Å—Ç–∞")
  
  // –§–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ (–¢–∞–π–º–µ—Ä)
  actualStart     DateTime?
  actualEnd       DateTime?
  
  // [CRITICAL]: –§–∏–∫—Å–∞—Ü–∏—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö —É—Å–ª–æ–≤–∏–π –≤ –º–æ–º–µ–Ω—Ç —Å—Ç–∞—Ä—Ç–∞
  rateAtStart     Int      // –°—Ç–∞–≤–∫–∞ –≤ –∫–æ–ø–µ–π–∫–∞—Ö/—Ü–µ–Ω—Ç–∞—Ö
  
  status          ShiftStatus @default(PLANNED)
  
  // –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
  startIp         String?
  startLat        Float?
  startLng        Float?
  
  isAutoClosed    Boolean  @default(false)
  comment         String?  // –î–ª—è –ø—Ä–∞–≤–æ–∫ –º–µ–Ω–µ–¥–∂–µ—Ä–∞
}

enum ShiftStatus {
  PLANNED
  ACTIVE
  COMPLETED
  PENDING_APPROVAL
  CANCELLED
}

```

```typescript
// prisma.config.ts - –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –∫–æ–Ω—Ñ–∏–≥
import { Prisma } from '@prisma/client';

export const prismaConfig: Prisma.PrismaClientOptions = {
  log: ['error', 'warn'],
  errorFormat: 'pretty',
};

```
