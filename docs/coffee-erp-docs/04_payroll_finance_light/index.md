# Модуль 04: Выплаты и Финансы

<!--toc:start-->

- [Модуль 04: Выплаты и Финансы](#модуль-04-выплаты-и-финансы)
  - [1. Назначение и Архитектура](#1-назначение-и-архитектура)
  - [2. Алгоритмы расчета и Налоги](#2-алгоритмы-расчета-и-налоги)
    - [2.1 Автоматический сплит](#21-автоматический-сплит)
    - [2.2 Rate Snapshot (Защита данных)](#22-rate-snapshot-защита-данных)
  - [3. Интерфейс сотрудника](#3-интерфейс-сотрудника)
    - [3.1 Расчетный листок](#31-расчетный-листок)
  - [4. Глобальные инструменты менеджера](#4-глобальные-инструменты-менеджера)
  - [5. Очередь разработки](#5-очередь-разработки)
  <!--toc:end-->

## 1. Назначение и Архитектура

- **Калькулятор выплат:** Система помогает считать ЗП, налоги (НДФЛ) и сплиты (Офиц/Бонус),
но не проводит реальные выплаты. Это инструмент для формирования ведомости,
которую бухгалтер или владелец использует для финальных операций.

- **Изоляция финансовых данных:** Финансовые поля (ставки, итоговые суммы) доступны только ролям с правом `view_payroll`.
  Для остальных пользователей, включая временных «Гостей» , эти данные всегда возвращают null.
- **Стек стилизации:** Интерфейс строится на SCSS Modules. Для выделения статусов выплат используются
  семантические переменные `$accent-primary` (выплачено) и `$accent-warning` (ожидает).

## 2. Алгоритмы расчета и Налоги

### 2.1 Автоматический сплит

Система поддерживает сложные схемы выплат (Белая, Серая, Черная). Реализован алгоритм автоматического разделения:

1. **Official Base:** Сумма, проходящая по карте согласно трудовому договору.
2. **Cash Balance:** Остаток, выплачиваемый из кассы (Модуль 05).
   Сплит рассчитывается автоматически при закрытии финансового периода.

### 2.2 Rate Snapshot (Защита данных)

При расчете используется значение ставки, зафиксированное в момент старта смены . Это защищает
систему от коллизий, когда изменение ставки сотрудника в середине месяца могло бы привести к пересчету уже
отработанных смен.

## 3. Интерфейс сотрудника

### 3.1 Расчетный листок

Личный кабинет бариста в мобильном приложении включает детализированный Paystub:

- **Time Log:** Список всех смен с указанием ролей и подтвержденных часов.
- **Bonus/Penalty Log:** Прозрачный реестр корректировок (премии за аттестацию из Модуля 06, вычеты за инциденты
  из Модуля 08).
- **Salary Trend:** Визуальный индикатор динамики дохода относительно прошлых периодов.

## 4. Глобальные инструменты менеджера

- **Mass Approval:** Функция «Утвердить всё» для быстрой проверки табеля всей сети при отсутствии аномалий.
- **KPI-аналитика:** Расчет показателя «Выручка на человека-час» для оценки эффективности планирования смен
- **Изоляция финансовых данных:** Финансовые поля (ставки, итоговые суммы) доступны только ролям с правом `view_payroll`.
  Для сторонних управляющих данные приглашенных «Гостей» всегда возвращают null.
  *Важно:* Сам сотрудник (даже в статусе Гостя) всегда имеет полный доступ к своему расчетному листку.

## 5. Очередь разработки

| ID        | Задача                                       | Статус         |
| :-------- | :------------------------------------------- | :------------- |
| [DEV-4.1] | Алгоритм автоматического сплита Card/Cash    | В разработке   |
| [DEV-4.3] | Личный кабинет с расчетным листком           | В разработке   |
| [DEV-4.5] | Salary Trend Indicator и визуализация KPI    | В разработке   |
| [ARCH-04] | Математическая модель налоговых схем         | Спроектировано |
