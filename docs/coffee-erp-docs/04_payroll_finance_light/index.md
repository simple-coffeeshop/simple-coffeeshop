# Модуль 04: Выплаты и Финансы (Payroll & Finance Light)

<!--toc:start-->

- [Модуль 04: Выплаты и Финансы (Payroll & Finance Light)](#модуль-04-выплаты-и-финансы-payroll-finance-light)
  - [1. Назначение и Архитектура](#1-назначение-и-архитектура)
  - [2. Алгоритмы расчета и Налоги](#2-алгоритмы-расчета-и-налоги)
    - [2.1 Автоматический сплит (Payment Split)](#21-автоматический-сплит-payment-split)
    - [2.2 Rate Snapshot (Защита данных)](#22-rate-snapshot-защита-данных)
  - [3. Интерфейс сотрудника (UX)](#3-интерфейс-сотрудника-ux)
    - [3.1 Расчетный листок (Paystub)](#31-расчетный-листок-paystub)
  - [4. Глобальные инструменты менеджера](#4-глобальные-инструменты-менеджера)
  - [5. Очередь разработки](#5-очередь-разработки)
  <!--toc:end-->

## 1. Назначение и Архитектура

Модуль предназначен для автоматического расчета вознаграждений на основе данных о рабочем времени из Модуля 03.
Система обеспечивает прозрачность начислений как для владельца, так и для бариста.

- **Изоляция финансовых данных:** Финансовые поля (ставки, итоговые суммы) доступны только ролям с правом `view_payroll`.
  Для остальных пользователей, включая временных «Гостей» (Guests), эти данные всегда возвращают null.
- **Стек стилизации:** Интерфейс строится на SCSS Modules. Для выделения статусов выплат используются
  семантические переменные `$accent-primary` (выплачено) и `$accent-warning` (ожидает).

## 2. Алгоритмы расчета и Налоги

### 2.1 Автоматический сплит (Payment Split)

Система поддерживает сложные схемы выплат (Белая, Серая, Черная). Реализован алгоритм автоматического разделения:

1. **Official Base:** Сумма, проходящая по карте согласно трудовому договору.
2. **Cash Balance:** Остаток, выплачиваемый из кассы (Модуль 05).
   Сплит рассчитывается автоматически при закрытии финансового периода.

### 2.2 Rate Snapshot (Защита данных)

При расчете используется значение ставки, зафиксированное в момент старта смены (Rate Snapshot). Это защищает
систему от коллизий, когда изменение ставки сотрудника в середине месяца могло бы привести к пересчету уже
отработанных смен.

## 3. Интерфейс сотрудника (UX)

### 3.1 Расчетный листок (Paystub)

Личный кабинет бариста в мобильном приложении включает детализированный Paystub:

- **Time Log:** Список всех смен с указанием ролей и подтвержденных часов.
- **Bonus/Penalty Log:** Прозрачный реестр корректировок (премии за аттестацию из Модуля 06, вычеты за инциденты
  из Модуля 08).
- **Salary Trend:** Визуальный индикатор динамики дохода относительно прошлых периодов.

## 4. Глобальные инструменты менеджера

- **Mass Approval:** Функция «Утвердить всё» для быстрой проверки табеля всей сети при отсутствии аномалий.
- **KPI-аналитика:** Расчет показателя «Выручка на человека-час» для оценки эффективности планирования смен
  .

## 5. Очередь разработки

| ID        | Задача                                       | Статус         |
| :-------- | :------------------------------------------- | :------------- |
| [DEV-4.1] | Алгоритм автоматического сплита Card/Cash    | В разработке   |
| [DEV-4.3] | Личный кабинет с расчетным листком (Paystub) | В разработке   |
| [DEV-4.5] | Salary Trend Indicator и визуализация KPI    | В разработке   |
| [ARCH-04] | Математическая модель налоговых схем         | Спроектировано |
