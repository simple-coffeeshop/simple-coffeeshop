# Super-Detailed Backlog: Coffee-ERP Automation System

## Phase 1: Ядро системы, Безопасность и Иерархия (Core)
* [ ] **1.1. Мультитенантная архитектура:** Реализация изоляции данных между "Бизнесами" на уровне БД.
* [ ] **1.2. Система инвайтов и онбординга:**
    * [ ] Генерация одноразовых Magic Links для регистрации.
    * [ ] Экран обязательного заполнения профиля (ФИО, Телефон, TG, Дата рождения) перед доступом к функциям.
* [ ] **1.3. Модуль Ownership Handshake:**
    * [ ] Логика инициации передачи прав GOD-аккаунта.
    * [ ] Механизм 168-часового Cooldown (заморозки) с возможностью отмены.
* [ ] **1.4. Управление структурой (Unit Management):**
    * [ ] CRUD для создания Предприятий и Подразделений (Unit).
    * [ ] Блокировка смены типа Unit (Точка/Склад/Производство) после создания первой записи данных.
* [ ] **1.5. Soft Delete 2.0:**
    * [ ] Глобальный флаг `is_archived` для всех сущностей.
    * [ ] Экран "Корзина" с 30-дневным хранением перед окончательным скрытием.
    * [ ] Настройка фильтрации в поиске: отображение архивных данных только по чекбоксу "Показать всё".

## Phase 2: Персонал, Комплаенс и Payroll (The People)
* [ ] **2.1. Контроль медицинских книжек (Compliance):**
    * [ ] Настройка 4 уровней уведомлений (>2 мес, <2 мес, <1 мес, Просрочено).
    * [ ] Интеграция ворнингов в график смен (подсветка ячеек).
    * [ ] Жесткая блокировка кнопки "Начать смену" при красном статусе (Просрочено).
* [ ] **2.2. Учет времени и "Анти-зомби":**
    * [ ] Кнопки "Старт/Стоп" с привязкой к Unit и проверкой активной смены в графике.
    * [ ] Скрипт авто-закрытия смен по достижении `MAX_SHIFT_DURATION`.
    * [ ] Механика перевода авто-закрытых смен в статус `Pending Approval` для ручной правки менеджером.
* [ ] **2.3. Визуальный конструктор премий (Staff Grid):**
    * [ ] Drag-and-drop интерфейс для перемещения Ролей и конкретных Сотрудников между группами %.
    * [ ] Система приоритетов: личная ставка/процент в карточке > глобальные настройки Роли.
* [ ] **2.4. Payroll-калькулятор:**
    * [ ] Расчет выплат по Белой/Серой/Черной схемам.
    * [ ] Экран детализации расчетного листка (часы, премии за аттестацию, штрафы за инциденты).

## Phase 3: Производство, Склад и ТТК (The Engine)
* [ ] **3.1. Движок ТТК 2.0:**
    * [ ] Динамические ссылки на ингредиенты через символ `@` (выбор строго из таблицы состава).
    * [ ] Логика вложенности: использование ТТК как ингредиента в другой ТТК (напр. Соус в Лазанье).
    * [ ] Калькулятор масштабирования: пересчет всех компонентов при изменении веса/объема выхода.
* [ ] **3.2. Умная система заявок:**
    * [ ] Вкладки разделения заказов по Именам складов-поставщиков.
    * [ ] Кнопка "Заполнить по шаблону": анализ среднего объема заказов за 4 недели с учетом MOQ.
    * [ ] Логика кнопок [+] [-] с шагом кратности MOQ (кванта заказа).
* [ ] **3.3. Ревизия и Декомпозиция:**
    * [ ] Планировщик сессий: автоматическое открытие "слепой ревизии" по расписанию (напр. по средам).
    * [ ] Функция "Разложить": визуальный разворот состава сложного компонента при вводе остатка.
    * [ ] Авто-суммирование ингредиентов из разложенных компонентов с "чистым" сырьем на складе.
    * [ ] Валидатор аномального ввода (предупреждение при вводе значения >10х от нормы).

## Phase 4: Операционный контроль и Качество (Quality)
* [ ] **4.1. Checklist & HACCP Engine:**
    * [ ] Конструктор регулярных обходов с привязкой к временным окнам.
    * [ ] Опциональное требование фото-фиксации для каждого пункта (блокировка завершения без фото).
    * [ ] Цифровые журналы температур и здоровья с авто-созданием инцидента при критических значениях.
* [ ] **4.2. Emergency Hub (Экстренная помощь):**
    * [ ] Справочник мастеров и сервисов в карточке каждого оборудования.
    * [ ] Карточка экстренного вызова: список всех доступных мастеров с кнопками "Позвонить" и SLA.
    * [ ] Логирование факта звонка мастеру (время, сотрудник, номер).
* [ ] **4.3. Предиктивное ТО:**
    * [ ] Счетчик рабочих циклов оборудования на базе данных из ТТК (проданные порции).
    * [ ] Система алертов менеджеру о необходимости замены расходников (прокладки, ножи).

## Phase 5: Аналитика, Маркетинг и Внешние связи (Business)
* [ ] **5.1. Финансовый мониторинг:**
    * [ ] Интерфейс ежедневного ввода выручки из Z-отчетов.
    * [ ] Расчет ежемесячного Food Cost (Себестоимость / Выручка).
    * [ ] Глобальный дашборд Владельца: сравнение FC, рейтинга чистоты и текучести по точкам.
* [ ] **5.2. Конструктор Аттестаций:**
    * [ ] Функционал "Вызова" на теорию (активация кнопки у сотрудника).
    * [ ] Интерфейс многосудейства для практики: расчет среднего балла и прозрачность оценок.
* [ ] **5.3. Маркетинговый движок:**
    * [ ] Конструктор акций (1+1, Счастливые часы).
    * [ ] Пересчет плановой маржи в ТТК на период действия акции.
* [ ] **5.4. Внешний интерфейс Поставщика:**
    * [ ] Доступ к списку входящих заявок и смена статуса "В пути" / "Доставлено".
