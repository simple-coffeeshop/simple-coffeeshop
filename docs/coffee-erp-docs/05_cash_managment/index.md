# Модуль 05: Выручка и Финансы (Cash Management)

<!--toc:start-->

- [Модуль 05: Выручка и Финансы (Cash Management)](#модуль-05-выручка-и-финансы-cash-management)
  - [1. Назначение и Ограничения](#1-назначение-и-ограничения)
  - [2. Операционные процессы](#2-операционные-процессы)
    - [2.1 Ввод выручки (Revenue Entry)](#21-ввод-выручки-revenue-entry)
    - [2.2 Учет расходов (Operational Expenses)](#22-учет-расходов-operational-expenses)
    - [2.3 Инкассация и Сейф](#23-инкассация-и-сейф)
  - [3. Глобальный кошелек Владельца](#3-глобальный-кошелек-владельца)
  - [4. Очередь разработки](#4-очередь-разработки)
  <!--toc:end-->

## 1. Назначение и Ограничения

Модуль предназначен для фиксации ежедневной выручки и операционных расходов. Система не является платежным
инструментом; все данные носят справочный характер для управленческого учета.

- **Strict Immutability & Storno:** Редактирование или удаление финансовых записей запрещено. Ошибки исправляются
  через механизм **Сторнирования** — создание новой записи, аннулирующей старую, с обязательным комментарием
  и логом автора.
- **Визуальный стиль:** Использование миксина `@include glass-morphism` для карточек финансовых отчетов
  и градиентных графиков выручки.

## 2. Операционные процессы

### 2.1 Ввод выручки (Revenue Entry)

Процесс закрытия смены привязан к Z-отчету:

- **Verification:** Сотрудник вводит выручку (Нал/Безнал) и прикрепляет фото чека Z-отчета (Z-Report Photo Audit).
- **Cash Gap Alert:** Если фактическая наличность отличается от расчетной, система создает алерт.
- **Revenue vs Labor Chart:** Визуальное наложение графиков выручки и затрат на персонал (Модуль 04) для
  мгновенного контроля Labor Cost %.

### 2.2 Учет расходов (Operational Expenses)

- **Manual Expense:** Ввод чеков (Обед, Хозтовары) с обязательным фото-подтверждением.
- **Auto-Transfer:** Автоматическое создание расходов при закрытии сервисных тикетов в Модуле 09
  (Ремонт и ТО).

### 2.3 Инкассация и Сейф

- **Predictive Safe Balance:** Система анализирует остаток в сейфе и присылает уведомление «Требуется инкассация»,
  если сумма превысила установленный порог.
- **Collection Logic:** Фиксация передачи денег Владельцу. Операция требует подтверждения (Accept) со стороны
  принимающего кошелька.

## 3. Глобальный кошелек Владельца

Владелец видит агрегированные данные:

- **Net Cash Flow:** Выручка минус COGS (Склад) минус OPEX (Расходы) и ЗП.
- **Safe Balance:** Суммарная наличность во всех сейфах сети в реальном времени.

## 4. Очередь разработки

| ID        | Задача                                       | Статус         |
| :-------- | :------------------------------------------- | :------------- |
| [DEV-5.4] | Логика корректирующих проводок (Storno)      | В разработке   |
| [DEV-5.5] | Виджет контроля лимита наличности в сейфе    | В разработке   |
| [DEV-5.1] | Форма ввода Z-отчета с валидацией и фото     | В разработке   |
| [ARCH-07] | Справочник категорий расходов (Global/Local) | Спроектировано |
